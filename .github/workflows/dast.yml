name: DAST

on:
  repository_dispatch:
    types: [dast-ais-ng-repository-dispatch]

jobs:
  zap_scan:
    name: Scan the web application with DAST

    uses: kubeopsskills-enterprise/ais-share-pipeline/.github/workflows/dast.yml@main
    with:
      TARGET_URL: 'https://white-sea-0feb97210.1.azurestaticapps.net/'
    secrets:
      TOKEN : ${{ secrets.GITHUB_TOKEN }}

  repository_dispatch:
    name: Repository dispatch
    needs: zap_scan

    uses: kubeopsskills-enterprise/ais-share-pipeline/.github/workflows/repository-dispatch.yml@main
    with:
      REPOSITORY: 'kubeopsskills-enterprise/man-ng-pipeline'
      EVENT_TYPE: 'integration-test-ais-ng-repository-dispatch'
      SHA: ${{ github.event.client_payload.github_sha }}
    secrets:
      PAT : ${{ secrets.ORG_PAT  }}