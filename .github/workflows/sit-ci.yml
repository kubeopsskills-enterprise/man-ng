name: SIT CI

on:
  push:
    tags:
      - "*.*.*"
  workflow_dispatch:
    inputs:
      tags:
        description: 'tags'
        required: true 

jobs:
  retrieve_latest_artifact:
    name: Retrieve latest artifact
    
    uses: kubeopsskills-enterprise/ais-share-pipeline/.github/workflows/retrieve-latest-build-info.yml@main

  dispatch-repository:
    name: Repository dispatch
    needs: retrieve_latest_artifact
    if: github.event.base_ref=='refs/heads/main' || github.event_name == 'workflow_dispatch'

    uses: kubeopsskills-enterprise/ais-share-pipeline/.github/workflows/repository-dispatch.yml@main
    with:
      REPOSITORY: 'kubeopsskills-enterprise/man-ng-pipeline'
      EVENT_TYPE: 'sit-ais-ng-repository-dispatch'
      SHA: ${{ needs.retrieve_latest_artifact.outputs.sha }}
    secrets:
      PAT : ${{ secrets.PAT  }}
